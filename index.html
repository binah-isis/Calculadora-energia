<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Monitoreo de Equipos Críticos</title>
  <style>
    /* Estilos generales */
    body {
      font-family: 'Roboto', sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f5f5f5;
    }

    .screen {
      width: 1280px;
      height: 1024px;
      background: #ffffff;
      border: 1px solid #ddd;
      border-radius: 10px;
      overflow-y: auto;
      display: none;
      padding: 20px;
    }

    .screen.active {
      display: block;
    }

    h1 {
      font-size: 24px;
      text-align: center;
      margin-bottom: 20px;
      color: #333;
    }

    button {
      width: 300px;
      height: 50px;
      margin: 10px auto;
      display: block;
      background-color: #007bff;
      color: #ffffff;
      border: none;
      border-radius: 16px;
      font-size: 18px;
      cursor: pointer;
    }

    button.small {
      width: 200px;
      height: 40px;
      background-color: #e0e0e0;
      color: #000;
    }

    button.green {
      background-color: #28a745;
    }

    button.blue {
      background-color: #007bff;
    }

    .form-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-size: 14px;
      color: #333;
    }

    input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }

    .alert {
      width: 300px;
      height: 70px;
      margin: 10px auto;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 12px;
      color: #ffffff;
      font-size: 14px;
      text-align: center;
    }

    .alert.critical {
      background-color: #ff4d4d;
    }

    .alert.moderate {
      background-color: #ffc107;
      color: #000;
    }

    .alert.low {
      background-color: #28a745;
    }
  </style>
</head>
<body>

  <!-- Pantalla 1: Inicio -->
  <div class="screen active" id="inicio">
    <h1>Monitoreo de Equipos Críticos</h1>
    <button onclick="goToScreen('datos')">Generadores</button>
    <button onclick="goToScreen('datos')">Sistemas de arranque</button>
    <button onclick="goToScreen('datos')">Válvulas de control</button>
    <button onclick="goToScreen('datos')">Sensores de presión</button>
    <button onclick="goToScreen('datos')">Sensores de aceite</button>
    <button class="small" onclick="alert('Historial no implementado')">Ver historial de datos</button>
  </div>

  <!-- Pantalla 2: Ingreso de Datos -->
  <div class="screen" id="datos">
    <h1>Ingreso de Datos: Generadores</h1>
    <form id="dataForm">
      <div class="form-group">
        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha" required />
      </div>
      <div class="form-group">
        <label for="vibracion">Vibración:</label>
        <input type="number" id="vibracion" step="0.01" required />
      </div>
      <div class="form-group">
        <label for="temperatura">Temperatura:</label>
        <input type="number" id="temperatura" step="0.01" required />
      </div>
      <div class="form-group">
        <label for="presion">Presión:</label>
        <input type="number" id="presion" step="0.01" required />
      </div>
      <button type="submit" class="green">Guardar datos y analizar</button>
    </form>
  </div>

  <!-- Pantalla 3: Alertas -->
  <div class="screen" id="alertas">
    <h1>Alertas detectadas</h1>
    <div id="alertList"></div>
    <button class="blue" onclick="goToScreen('inicio')">Ver tendencias históricas</button>
  </div>

  <script>
    // Función para navegar entre pantallas
    function goToScreen(screenId) {
      document.querySelectorAll('.screen').forEach(screen => {
        screen.classList.remove('active');
      });
      document.getElementById(screenId).classList.add('active');
    }

    // Listener para el formulario de ingreso de datos
    const form = document.getElementById("dataForm");
    form.addEventListener("submit", (e) => {
      e.preventDefault();

      const data = {
        equipo: "Generadores",
        fecha: document.getElementById("fecha").value,
        vibracion: parseFloat(document.getElementById("vibracion").value),
        temperatura: parseFloat(document.getElementById("temperatura").value),
        presion: parseFloat(document.getElementById("presion").value),
      };

      fetch("http://localhost:3000/api/lecturas", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
        },
        body: JSON.stringify(data),
      })
        .then((response) => {
          if (response.ok) {
            alert("Datos guardados exitosamente.");
            form.reset();
            goToScreen("alertas");
            loadAlerts();
          } else {
            alert("Error al guardar los datos.");
          }
        })
        .catch((error) => console.error("Error:", error));
    });

    // Función para cargar alertas desde el backend
    function loadAlerts() {
      fetch("http://localhost:3000/api/lecturas")
        .then((response) => response.json())
        .then((data) => {
          const alertList = document.getElementById("alertList");
          alertList.innerHTML = "";

          data.forEach((alerta) => {
            const alertDiv = document.createElement("div");
            alertDiv.classList.add("alert");

            // Establecer color según vibración (ejemplo de lógica)
            if (alerta.vibracion > 15) {
              alertDiv.classList.add("critical");
              alertDiv.textContent = `CRÍTICO: Vibración fuera de rango (${alerta.vibracion})`;
            } else if (alerta.vibracion > 10) {
              alertDiv.classList.add("moderate");
              alertDiv.textContent = `MODERADO: Vibración cercana al límite (${alerta.vibracion})`;
            } else {
              alertDiv.classList.add("low");
              alertDiv.textContent = `LEVE: Vibración normal (${alerta.vibracion})`;
            }

            alertList.appendChild(alertDiv);
          });
        })
        .catch((error) => console.error("Error al cargar alertas:", error));
    }

    // Cargar alertas al cargar la pantalla
    document.addEventListener("DOMContentLoaded", loadAlerts);
  </script>

</body>
</html>

